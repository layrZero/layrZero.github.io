"use strict";(self.webpackChunkscaffold=self.webpackChunkscaffold||[]).push([[8539],{5252:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>l,contentTitle:()=>s,default:()=>y,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"trading-platform/amibroker/button-trading-with-spit-order-options","title":"Button Trading with Spit Order (Options)","description":"This OpenAlgo SplitOrder Trading Module for AmiBroker is designed to seamlessly integrate manual button-based trading into an algorithmic workflow. It allows traders to place orders on options (ATM, ITM, OTM for both Calls and Puts) directly from the AmiBroker chart interface by clicking visual buttons. Each button sends orders through the OpenAlgo Bridge using the /splitorder endpoint, which intelligently splits large orders into smaller chunks as per the configured split size. The system dynamically calculates the ATM, ITM, and OTM strikes based on live market data, user-defined offsets, and strike intervals, ensuring that the correct option symbols are generated for execution. A graphical dashboard embedded in the chart shows the current calculated strikes, internal memory for each option leg, cumulative quantities traded, and the current algo enable/disable status, providing traders with full visibility and control.","source":"@site/docs/trading-platform/amibroker/button-trading-with-spit-order-options.md","sourceDirName":"trading-platform/amibroker","slug":"/trading-platform/amibroker/button-trading-with-spit-order-options","permalink":"/docs/trading-platform/amibroker/button-trading-with-spit-order-options","draft":false,"unlisted":false,"editUrl":"https://github.com/layrZero/layrZero.github.io/tree/main/docs/trading-platform/amibroker/button-trading-with-spit-order-options.md","tags":[],"version":"current","frontMatter":{}}');var r=n(4848),o=n(8453);const i={},s="Button Trading with Spit Order (Options)",l={},c=[];function m(t){const e={code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,o.R)(),...t.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"button-trading-with-spit-order-options",children:"Button Trading with Spit Order (Options)"})}),"\n",(0,r.jsxs)(e.p,{children:["This OpenAlgo SplitOrder Trading Module for AmiBroker is designed to seamlessly integrate manual button-based trading into an algorithmic workflow. It allows traders to place orders on options (ATM, ITM, OTM for both Calls and Puts) directly from the AmiBroker chart interface by clicking visual buttons. Each button sends orders through the OpenAlgo Bridge using the ",(0,r.jsx)(e.code,{children:"/splitorder"})," endpoint, which intelligently splits large orders into smaller chunks as per the configured split size. The system dynamically calculates the ATM, ITM, and OTM strikes based on live market data, user-defined offsets, and strike intervals, ensuring that the correct option symbols are generated for execution. A graphical dashboard embedded in the chart shows the current calculated strikes, internal memory for each option leg, cumulative quantities traded, and the current algo enable/disable status, providing traders with full visibility and control."]}),"\n",(0,r.jsx)("img",{src:n(5989).A}),"\n",(0,r.jsx)(e.p,{children:"Additionally, the module tracks how many shares or lots have been cumulatively ordered through each button. This allows precise exits later by automatically sending exactly the accumulated quantity in the opposite direction, ensuring positions are squared off cleanly. It includes a \u201cClose All\u201d button that closes all open positions for all option legs using the exact quantities stored in memory, and also provides a \u201cClear Memory\u201d button to reset internal counters without sending any orders. The system can be configured for both option buyers (to initiate long call or put positions) and option sellers (to short calls or puts and later cover), making it highly versatile for different option trading strategies. This entire workflow is designed for intraday or short-term traders who want to streamline order placement, reduce manual errors, and maintain a tight control over their option trades directly from their AmiBroker environment."}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-clike",children:'//Rajandran R - Creator of OpenAlgo\n//OpenAlgo - Amibroker SplitOrder Module with cumulative qty & explicit current strikes\n//Date: 07/07/2025\n\n_SECTION_BEGIN("OpenAlgo Options SplitOrder Trading");\n\nRequestTimedRefresh(1,False);\nEnableTextOutput(False);\nSetOption("StaticVarAutoSave", 30 );\n\napikey     = ParamStr("OpenAlgo API Key", "******");\nstrategy   = ParamStr("Strategy Name", "Test Strategy");\nspot       = Paramlist("Spot Symbol","NIFTY|BANKNIFTY|FINNIFTY|SENSEX|CRUDEOILM");\nexpiry     = ParamStr("Expiry Date","17JUL25");\nexchange   = ParamList("Exchange","NFO|BFO|MCX",0);\nSymbol     = ParamStr("Underlying Symbol(Data Vendor Symbol)","NIFTY");\niInterval  = Param("Strike Interval",50,1,10000,1);\nStrikeCalculation = Paramlist("Strike Calculation","TODAYSOPEN",0);\nLotSize    = Param("Lot Size",75,1,10000,1);\n\nATMoffsetCE = Param("ATM CE Offset",0,-40,40,1);\nITMoffsetCE = Param("ITM CE Offset",-2,-40,-1,1);\nOTMoffsetCE = Param("OTM CE Offset",4,1,40,1);\nATMoffsetPE = Param("ATM PE Offset",0,-40,40,1);\nITMoffsetPE = Param("ITM PE Offset",-2,-40,-1,1);\nOTMoffsetPE = Param("OTM PE Offset",4,1,40,1);\n\npricetype  = ParamList("Order Type","MARKET",0);\nproduct    = ParamList("Product","MIS|NRML",1);\ntradetype  = ParamList("Option Trade Type","BUY|SELL",0);\n\nquantity   = Param("Total Quantity(Lot Size)",1,0,10000,1)*LotSize;\nsplitsize  = Param("Split Size",25,1,10000,1);\n\nhost       = ParamStr("host","http://127.0.0.1:5000");\nver        = ParamStr("API Version","v1");\nVoiceAlert = ParamList("Voice Alert","Disable|Enable",1);\nEnableAlgo = ParamList("AlgoStatus","Disable|Enable",0);\n\nbridgeurl = host+"/api/"+ver;\n\n\n//Static Variables for Order protection\nstatic_name_ = Name()+GetChartID()+interval(2)+strategy;\nstatic_name_algo = Name()+GetChartID()+interval(2)+strategy+"algostatus";\n\n//OpenAlgo Dashboard\n\nGfxSelectFont( "BOOK ANTIQUA", 14, 100 );\nGfxSetBkMode( 1 );\nif(EnableAlgo == "Enable")\n{\nAlgoStatus = "Algo Enabled";\nGfxSetTextColor( colorGreen ); \nGfxTextOut( "Algostatus : "+AlgoStatus , 20, 40); \nif(Nz(StaticVarGet(static_name_algo),0)!=1)\n{\n_TRACE("Algo Status : Enabled");\nStaticVarSet(static_name_algo, 1);\n}\n}\nif(EnableAlgo == "Disable")\n{\nAlgoStatus = "Algo Disabled";\nGfxSetTextColor( colorRed ); \nGfxTextOut( "Algostatus : "+AlgoStatus , 20, 40); \nif(Nz(StaticVarGet(static_name_algo),0)!=0)\n{\n_TRACE("Algo Status : Disabled");\nStaticVarSet(static_name_algo, 0);\n}\n}\n\nGfxSetTextColor( colorWhite ); \n\n// Strike Calculation\nif(StrikeCalculation=="PREVOPEN"){ SetForeign(Symbol); spotC = LastValue(Ref(OPEN,-1)); RestorePriceArrays();}\nif(StrikeCalculation=="PREVCLOSE"){ SetForeign(Symbol); spotC = LastValue(Ref(Close,-1)); RestorePriceArrays();}\nif(StrikeCalculation=="TODAYSOPEN"){ SetForeign(Symbol); spotC = LastValue(TimeFrameGetPrice("O",inDaily)); RestorePriceArrays();}\n\nstrike = IIf(spotC % iInterval > iInterval/2, spotC - (spotC%iInterval) + iInterval, spotC - (spotC%iInterval));\n\nATMstrikeCE = strike + (ATMoffsetCE * iInterval);\nATMstrikePE = strike - (ATMoffsetPE * iInterval);\nITMstrikeCE = strike + (ITMoffsetCE * iInterval);\nITMstrikePE = strike - (ITMoffsetPE * iInterval);\nOTMstrikeCE = strike + (OTMoffsetCE * iInterval);\nOTMstrikePE = strike - (OTMoffsetPE * iInterval);\n\nATMsymbolCE = spot+expiry+ATMstrikeCE+"CE";\nATMsymbolPE = spot+expiry+ATMstrikePE+"PE";\nITMsymbolCE = spot+expiry+ITMstrikeCE+"CE";\nITMsymbolPE = spot+expiry+ITMstrikePE+"PE";\nOTMsymbolCE = spot+expiry+OTMstrikeCE+"CE";\nOTMsymbolPE = spot+expiry+OTMstrikePE+"PE";\n\n// Interpretation Print - current strikes\nprintf("\\n ------ Current Strikes ------");\nprintf("\\n ATM CE = " + ATMsymbolCE);\nprintf("\\n ATM PE = " + ATMsymbolPE);\nprintf("\\n ITM CE = " + ITMsymbolCE);\nprintf("\\n ITM PE = " + ITMsymbolPE);\nprintf("\\n OTM CE = " + OTMstrikeCE);\nprintf("\\n OTM PE = " + OTMstrikePE);\n\nprintf("\\n ------ Memory State ------");\nprintf("\\n ATMsymbolCE = " + StaticVarGetText(static_name_+"ATMsymbolCE") + " | Qty: " + NumToStr(Nz(StaticVarGet(static_name_+"ATMsymbolCE_qty")),1.0));\nprintf("\\n ITMsymbolCE = " + StaticVarGetText(static_name_+"ITMsymbolCE") + " | Qty: " + NumToStr(Nz(StaticVarGet(static_name_+"ITMsymbolCE_qty")),1.0));\nprintf("\\n OTMsymbolCE = " + StaticVarGetText(static_name_+"OTMsymbolCE") + " | Qty: " + NumToStr(Nz(StaticVarGet(static_name_+"OTMsymbolCE_qty")),1.0));\nprintf("\\n ATMsymbolPE = " + StaticVarGetText(static_name_+"ATMsymbolPE") + " | Qty: " + NumToStr(Nz(StaticVarGet(static_name_+"ATMsymbolPE_qty")),1.0));\nprintf("\\n ITMsymbolPE = " + StaticVarGetText(static_name_+"ITMsymbolPE") + " | Qty: " + NumToStr(Nz(StaticVarGet(static_name_+"ITMsymbolPE_qty")),1.0));\nprintf("\\n OTMsymbolPE = " + StaticVarGetText(static_name_+"OTMsymbolPE") + " | Qty: " + NumToStr(Nz(StaticVarGet(static_name_+"OTMsymbolPE_qty")),1.0));\n\n_SECTION_BEGIN("OpenAlgo Bridge SplitOrder Controls");\n\nEnableScript("VBScript");\n<%\nPublic Sub PlaceSplitOrder(symbol,action, quantity, splitsize)\n    Dim oXMLHTTP\n    Set oXMLHTTP = CreateObject("Msxml2.XMLHTTP")\n    Dim apikey, strategy, exchange, pricetype, product\n    apikey = AFL.Var("apikey")\n    strategy = AFL.Var("strategy")\n    exchange = AFL.Var("exchange")\n    pricetype = AFL.Var("pricetype")\n    product = AFL.Var("product")\n\n    Dim jsonRequestBody\n    jsonRequestBody = "{""apikey"":""" & apikey & _\n    """,""strategy"":""" & strategy & _\n    """,""symbol"":""" & symbol & _\n    """,""action"":""" & action & _\n    """,""exchange"":""" & exchange & _\n    """,""pricetype"":""" & pricetype & _\n    """,""product"":""" & product & _\n    """,""quantity"":""" & quantity & _\n    """,""splitsize"":""" & splitsize & """}"\n\n    Dim url\n    url = AFL.Var("bridgeurl") & "/splitorder"\n\n    oXMLHTTP.Open "POST", url, False\n    oXMLHTTP.setRequestHeader "Content-Type", "application/json"\n    oXMLHTTP.Send jsonRequestBody\n\n    AFL("api_request") = jsonRequestBody\n    AFL("api_response") = oXMLHTTP.responseText\nEnd Sub\n%>\nopenalgo = GetScriptObject();\n_SECTION_END();\n\n// Global TryClose\nprocedure TryClose(sym)\n{\n    exitSymbol = StaticVarGetText(static_name_+sym);\n    totalQty = Nz(StaticVarGet(static_name_+sym+"_qty"),0);\n    if(exitSymbol!="" AND totalQty>0)\n    {\n        openalgo.PlaceSplitOrder(exitSymbol, "SELL", totalQty, splitsize);\n        _TRACE("CloseAll - " + sym + " API Request : " + api_request);\n        _TRACE("CloseAll - " + sym + " API Response : " + api_response);\n    }\n    StaticVarSetText(static_name_+sym, "");\n    StaticVarSet(static_name_+sym+"_qty", 0);\n}\n\n// Universal helpers\nX0=20; Y0=100; X1=60;\nLBClick = GetCursorMouseButtons() == 9;\nMouseX  = Nz(GetCursorXPosition(1));\nMouseY  = Nz(GetCursorYPosition(1));\n\nprocedure DrawButton (Text, x1, y1, x2, y2, colorFrom, colorTo)\n{\n\tGfxSetOverlayMode(0);\n\tGfxSelectFont("Verdana", 9, 700);\n\tGfxSetBkMode(1);\n\tGfxGradientRect(x1, y1, x2, y2, colorFrom, colorTo);\n\tGfxDrawText(Text, x1, y1, x2, y2, 32|1|4|16);\n}\n\nprocedure HandleTrade(symbolVar, memoryKey, buyText, exitText, x, y)\n{\n    DrawButton(buyText, x, y, x+X1+50, y+50, colorGreen, colorGreen);\n    cursorInBuy = MouseX>=x AND MouseX<=x+X1+50 AND MouseY>=y AND MouseY<=y+50;\n    btnClickBuy = cursorInBuy AND LBClick;\n\n    if(btnClickBuy AND StaticVarGet(static_name_+memoryKey+"E")==0)\n    {\n        openalgo.PlaceSplitOrder(symbolVar, tradetype, quantity, splitsize);\n        _TRACE("API Request : " + api_request);\n        _TRACE("API Response : " + api_response);\n\n        StaticVarSetText(static_name_+memoryKey, symbolVar, True);\n        prevQty = Nz(StaticVarGet(static_name_+memoryKey+"_qty"), 0);\n        StaticVarSet(static_name_+memoryKey+"_qty", prevQty + quantity);\n\n        if(VoiceAlert=="Enable"){ Say(buyText+" Order"); }\n        StaticVarSet(static_name_+memoryKey+"E",1);\n    }\n    else { StaticVarSet(static_name_+memoryKey+"E",0); }\n\n    DrawButton(exitText, x, y+55, x+X1+50, y+105, colorRed, colorRed);\n    cursorInExit = MouseX>=x AND MouseX<=x+X1+50 AND MouseY>=y+55 AND MouseY<=y+105;\n    btnClickExit = cursorInExit AND LBClick;\n\n    if(btnClickExit AND StaticVarGet(static_name_+"x"+memoryKey)==0)\n    {\n        exitSymbol = StaticVarGetText(static_name_+memoryKey);\n        totalQty   = Nz(StaticVarGet(static_name_+memoryKey+"_qty"),0);\n\n        if(exitSymbol!="" AND totalQty>0)\n        {\n            openalgo.PlaceSplitOrder(exitSymbol, "SELL", totalQty, splitsize);\n            _TRACE("API Request : " + api_request);\n            _TRACE("API Response : " + api_response);\n            if(VoiceAlert=="Enable"){ Say("Exit "+exitText); }\n        }\n        StaticVarSetText(static_name_+memoryKey, "");\n        StaticVarSet(static_name_+memoryKey+"_qty", 0);\n        StaticVarSet(static_name_+"x"+memoryKey, 1);\n    }\n    else { StaticVarSet(static_name_+"x"+memoryKey, 0); }\n}\n\n_SECTION_BEGIN("Buttons with close all & clear memory");\n\nif(EnableAlgo == "Enable")\n{\n    HandleTrade(ATMsymbolCE, "ATMsymbolCE", "ATM CE", "x ATM CE", 20, 100);\n    HandleTrade(ITMsymbolCE, "ITMsymbolCE", "ITM CE", "x ITM CE", 140, 100);\n    HandleTrade(OTMsymbolCE, "OTMsymbolCE", "OTM CE", "x OTM CE", 260, 100);\n\n    HandleTrade(ATMsymbolPE, "ATMsymbolPE", "ATM PE", "x ATM PE", 20, 240);\n    HandleTrade(ITMsymbolPE, "ITMsymbolPE", "ITM PE", "x ITM PE", 140, 240);\n    HandleTrade(OTMsymbolPE, "OTMsymbolPE", "OTM PE", "x OTM PE", 260, 240);\n\n    DrawButton("Close All", 20, 380, 200, 430, colorRed, colorRed);\n    closeAll = MouseX>=20 AND MouseX<=200 AND MouseY>=380 AND MouseY<=430 AND LBClick;\n    if(closeAll)\n    {\n        TryClose("ATMsymbolCE"); TryClose("ITMsymbolCE"); TryClose("OTMsymbolCE");\n        TryClose("ATMsymbolPE"); TryClose("ITMsymbolPE"); TryClose("OTMsymbolPE");\n        Say("All Positions Closed and Memory Cleared");\n    }\n\n    DrawButton("Clear Memory", 220, 380, 400, 430, colorBlue, colorBlue);\n    clearMem = MouseX>=220 AND MouseX<=400 AND MouseY>=380 AND MouseY<=430 AND LBClick;\n    if(clearMem)\n    {\n        StaticVarSetText(static_name_+"ATMsymbolCE",""); StaticVarSet(static_name_+"ATMsymbolCE_qty",0);\n        StaticVarSetText(static_name_+"ITMsymbolCE",""); StaticVarSet(static_name_+"ITMsymbolCE_qty",0);\n        StaticVarSetText(static_name_+"OTMsymbolCE",""); StaticVarSet(static_name_+"OTMsymbolCE_qty",0);\n        StaticVarSetText(static_name_+"ATMsymbolPE",""); StaticVarSet(static_name_+"ATMsymbolPE_qty",0);\n        StaticVarSetText(static_name_+"ITMsymbolPE",""); StaticVarSet(static_name_+"ITMsymbolPE_qty",0);\n        StaticVarSetText(static_name_+"OTMsymbolPE",""); StaticVarSet(static_name_+"OTMsymbolPE_qty",0);\n        Say("Internal Memory Cleared");\n    }\n}\n_SECTION_END();\n\n_SECTION_BEGIN("Candlestick Charts");\nSetChartOptions(0, chartShowArrows|chartShowDates);\nPlot(Close,"Candle",colorDefault,styleCandle);\n_SECTION_END();\n\n'})})]})}function y(t={}){const{wrapper:e}={...(0,o.R)(),...t.components};return e?(0,r.jsx)(e,{...t,children:(0,r.jsx)(m,{...t})}):m(t)}},5989:(t,e,n)=>{n.d(e,{A:()=>a});const a=n.p+"assets/images/Split Order - Options-6aff8661008ea80061c8686d4d9ffe6d.png"},8453:(t,e,n)=>{n.d(e,{R:()=>i,x:()=>s});var a=n(6540);const r={},o=a.createContext(r);function i(t){const e=a.useContext(o);return a.useMemo(function(){return"function"==typeof t?t(e):{...e,...t}},[e,t])}function s(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(r):t.components||r:i(t.components),a.createElement(o.Provider,{value:e},t.children)}}}]);