"use strict";(self.webpackChunkscaffold=self.webpackChunkscaffold||[]).push([[2704],{1194:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>d,contentTitle:()=>p,default:()=>c,frontMatter:()=>o,metadata:()=>t,toc:()=>s});const t=JSON.parse('{"id":"trading-platform/python/supertrend-strategy-with-yfinance-data","title":"Supertrend Strategy with yfinance data","description":"Here is a coding snippet of python based supertrend strategy implementing using placesmartorder function.","source":"@site/docs/trading-platform/python/supertrend-strategy-with-yfinance-data.md","sourceDirName":"trading-platform/python","slug":"/trading-platform/python/supertrend-strategy-with-yfinance-data","permalink":"/docs/trading-platform/python/supertrend-strategy-with-yfinance-data","draft":false,"unlisted":false,"editUrl":"https://github.com/layrZero/layrZero.github.io/tree/main/docs/trading-platform/python/supertrend-strategy-with-yfinance-data.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Strategy Management","permalink":"/docs/trading-platform/python/strategy-management"},"next":{"title":"Supertrend Strategy","permalink":"/docs/trading-platform/python/supertrend-strategy"}}');var a=r(4848),i=r(8453);const o={},p="Supertrend Strategy with yfinance data",d={},s=[];function l(n){const e={code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,i.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"supertrend-strategy-with-yfinance-data",children:"Supertrend Strategy with yfinance data"})}),"\n",(0,a.jsx)(e.p,{children:"Here is a coding snippet of python based supertrend strategy implementing using placesmartorder function."}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:'\n\n#Coded by Rajandran R - www.marketcalls.in / www.openalgo.in\n\nfrom openalgo import api\nimport yfinance as yf\nimport pandas as pd\nimport numpy as np\nimport time\nimport threading\nimport os\n\n\n# Get API key from openalgo portal\napi_key = \'your_openalgo_apikey\'\n\n#set the StrategyName, broker code, Trading symbol, exchange, product and quantity\nstrategy = "Supertrend Python"\nsymbol = "RELIANCE"  #OpenAlgo Symbol\nexchange = "NSE"\nproduct="MIS"\nquantity = 1\n\n#yfinance datafeed settings\nyfsymbol = "RELIANCE.NS" #Yahoo Finance Datafeed Symbol\nperiod = "1d"\ntimeframe = "1m"\n\n#supertrend indicator inputs\natr_period = 5\natr_multiplier = 1.0\n\n# Set the API Key \nclient = api(api_key=api_key, host=\'http://127.0.0.1:5000\')\n\ndef Supertrend(df, atr_period, multiplier):\n    high = df[\'High\']\n    low = df[\'Low\']\n    close = df[\'Close\']\n    \n    # calculate ATR\n    price_diffs = [high - low, high - close.shift(), close.shift() - low]\n    true_range = pd.concat(price_diffs, axis=1)\n    true_range = true_range.abs().max(axis=1)\n    atr = true_range.ewm(alpha=1/atr_period, min_periods=atr_period).mean()\n    \n    hl2 = (high + low) / 2\n    final_upperband = upperband = hl2 + (multiplier * atr)\n    final_lowerband = lowerband = hl2 - (multiplier * atr)\n    \n    supertrend = [True] * len(df)\n    \n    for i in range(1, len(df.index)):\n        curr, prev = i, i-1\n        \n        if close.iloc[curr] > final_upperband.iloc[prev]:\n            supertrend[curr] = True\n        elif close.iloc[curr] < final_lowerband.iloc[prev]:\n            supertrend[curr] = False\n        else:\n            supertrend[curr] = supertrend[prev]\n            \n            if supertrend[curr] == True and final_lowerband.iloc[curr] < final_lowerband.iloc[prev]:\n                final_lowerband.iat[curr] = final_lowerband.iat[prev]\n            if supertrend[curr] == False and final_upperband.iloc[curr] > final_upperband.iloc[prev]:\n                final_upperband.iat[curr] = final_upperband.iat[prev]\n\n        if supertrend[curr] == True:\n            final_upperband.iat[curr] = np.nan\n        else:\n            final_lowerband.iat[curr] = np.nan\n    \n    return pd.DataFrame({\n        \'Supertrend\': supertrend,\n        \'Final Lowerband\': final_lowerband,\n        \'Final Upperband\': final_upperband\n    }, index=df.index)\n\ndef supertrend_strategy():\n    stock = yf.Ticker(yfsymbol)\n    position = 0\n    \n    while True:\n        df = stock.history(period=period, interval=timeframe)\n        close = df[\'Close\'].round(2)\n        supertrend = Supertrend(df, atr_period, atr_multiplier)\n        \n        is_uptrend = supertrend[\'Supertrend\']\n        longentry = is_uptrend.iloc[-2] and not is_uptrend.iloc[-3]\n        shortentry = is_uptrend.iloc[-3] and not is_uptrend.iloc[-2]\n\n        if longentry and position <= 0:\n            position = quantity\n            response = client.placesmartorder(\n                        strategy=strategy,\n                        symbol=symbol,\n                        action="BUY",\n                        exchange=exchange,\n                        price_type="MARKET",\n                        product=product,\n                        quantity=quantity,\n                        position_size=position\n                        )\n            print("Buy Order Response:", response)\n\n        elif shortentry and position >= 0:\n            position = quantity * -1\n            response = client.placesmartorder(\n                        strategy=strategy,\n                        symbol=symbol,\n                        action="SELL",\n                        exchange=exchange,\n                        price_type="MARKET",\n                        product=product,\n                        quantity=quantity,\n                        position_size=position\n                        )\n            print("Sell Order Response:", response)\n\n        print("Position:", position)\n        print("LTP:", close.iloc[-1])\n        print("Supertrend:", supertrend[\'Supertrend\'].iloc[-2])\n        print("LowerBand:", supertrend[\'Final Lowerband\'].iloc[-2].round(2))\n        print("UpperBand:", supertrend[\'Final Upperband\'].iloc[-2].round(2))\n        print("longentry:", longentry)\n        print("shortentry:", shortentry)\n\n        time.sleep(15)\n\nt = threading.Thread(target=supertrend_strategy)\nt.start()\n'})})]})}function c(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(l,{...n})}):l(n)}},8453:(n,e,r)=>{r.d(e,{R:()=>o,x:()=>p});var t=r(6540);const a={},i=t.createContext(a);function o(n){const e=t.useContext(i);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function p(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:o(n.components),t.createElement(i.Provider,{value:e},n.children)}}}]);